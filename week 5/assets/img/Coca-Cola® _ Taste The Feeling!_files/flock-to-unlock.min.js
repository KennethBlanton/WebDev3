(function(a){a.module("flock-to-unlock",["utility","ngSanitize","angularSpinner"])
}(window.angular));
(function(b){function a(){function f(h,g){return{id:h.milestoneID.toString(),name:h.name,unlockPoints:h.milestoneValue,entries:h.entries,inProgress:!g&&!h.isCompleted,isCompleted:h.isCompleted,isLocked:h.entries>=h.milestoneValue}
}function e(h){var g=false;
return h.map(function(i){var j=f(i,g);
g=g||j.inProgress;
return j
})
}function d(h){var g=h.totalExpectedEntries>0?h.totalEntries/h.totalExpectedEntries*100:0;
return parseFloat(g.toFixed(0),10)
}return{wrap:function c(i){if(!i.data.milestones){return{}
}var k=i.data,j=k.milestones,h=e(j),l={milestones:h,totalExpectedEntries:k.totalExpectedEntries,totalEntries:k.totalEntries},g=d(l);
l.completionStatusPercentage=g;
return l
}}
}b.module("flock-to-unlock").factory("flock-to-unlock.services.api-wrapper",a);
a.$inject=[]
}(window.angular));
(function(b){function a(c,d){return{getProgress:function e(h){var g=c.endpoint+"api/getCampaignOutcomeProgress/"+h.campaignId,f={method:"get"};
return d.create(f).call(g)
}}
}b.module("flock-to-unlock").factory("flock-to-unlock.services.api",a);
a.$inject=["utility.mks-config","utility.api-factory"]
}(window.angular));
(function(a){function b(e,c,d){var g=this;
function h(m,k,l){m.name=k.name||m.name;
m.position=m.unlockPoints/l*100+"%";
m.stepLockedImage=k.stepLockedImage;
m.stepUnlockedImage=k.stepUnlockedImage;
return m
}function i(k){if(k.unlockPoints>g.totalEntries&&!k.inProgress){k.image=k.stepLockedImage;
k.srLabel="milestone prize is locked";
return k
}k.image=k.stepUnlockedImage;
if(k.inProgress){k.srLabel="milestone prize in progress";
k.milestoneClass="inProgress"
}else{k.srLabel="milestone prize is unlocked";
k.milestoneClass="complete"
}return k
}function f(k,l){return k.reduce(function(o,n){var m=l.filter(function(p){return p.id===n.id
})[0];
if(m&&(n.unlockPoints>o)){return n.unlockPoints
}return o
},0)
}function j(){var l,k;
l=g.milestones.reduce(function(m,n){if(n.isCompleted&&(m<n.unlockPoints)){return n.unlockPoints
}return m
},0);
k=l;
g.milestones.forEach(function(m){if(m.inProgress){k=m.unlockPoints
}});
g.currentMilestoneStart=l/g.totalExpectedEntries*100+"%";
g.currentMilestoneSize=(k-l)/g.totalExpectedEntries*100+"%";
if(l!==k){g.currentMilestoneCompleteness=Math.floor((g.totalEntries-l)/(k-l)*100)
}else{g.currentMilestoneCompleteness=100
}}g.$onInit=function(){g.isLoading=true;
e.getProgress({campaignId:g.settings.campaignId}).then(c.wrap).then(function(k){var m,l;
m=f(k.milestones,g.settings.authoredMilestones);
g.milestones=k.milestones.reduce(function(o,p){var n=g.settings.authoredMilestones.filter(function(q){return q.id===p.id
})[0];
if(n){p=h(p,n,m,k.totalEntries);
o.push(p)
}return o
},[]);
g.totalExpectedEntries=m;
g.totalEntries=Math.min(k.totalEntries,g.totalExpectedEntries);
l=false;
g.milestones.forEach(function(n){if(n.unlockPoints>g.totalEntries&&!l){n.inProgress=true;
l=true
}else{n.inProgress=false
}});
g.milestones.forEach(i);
j();
g.isLoading=false
},function(){g.isLoading=false;
g.hasError=true
})
};
g.notSanitizedHTML=d.trustAsHtml
}a.module("flock-to-unlock").component("flockToUnlock",{templateUrl:"/etc/clientlibs/marketingservices/angular-components/flock-to-unlock/template/flockToUnlock.html",controller:b,bindings:{settings:"<"}});
b.$inject=["flock-to-unlock.services.api","flock-to-unlock.services.api-wrapper","$sce"]
}(window.angular));
(function(a){a.module("flock-to-unlock").component("milestone",{templateUrl:"/etc/clientlibs/marketingservices/angular-components/flock-to-unlock/template/milestone.html",controller:function(){},bindings:{settings:"<"}})
}(window.angular));