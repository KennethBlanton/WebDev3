(function(){function a(b,d,c){if(!window.FileReader){throw new Error("Your browser does not support FileReader")
}function e(h){var g=b.defer(),f=new d.FileReader();
f.onload=function(){c.resizeImage(f.result).then(function(i){g.resolve(i)
})
};
f.onerror=function(){g.reject(f.error)
};
f.readAsDataURL(h);
return g.promise
}return{readAsDataUrl:e}
}angular.module("fileReader",[]).factory("FileReader",a);
a.$inject=["$q","$window","ImageResize"]
}());
(function(){function a(f,d){var j={invisible:true,imageConversion:{greyscale:true,resizeTo:240,exportFormat:"image/jpeg",exportQuality:0.8}},b=144,c=function(m){var k=f.defer(),l=document.createElement("img");
l.onload=function(){if(this.naturalHeight){if(this.naturalHeight+this.naturalWidth===0){this.onerror();
return
}}else{if(this.width+this.height===0){this.onerror();
return
}}k.resolve(l)
};
l.onerror=function(){k.reject(new Error("Invalid Image"))
};
l.src=m;
return k.promise
},h=function(k){var m=k.getContext("2d"),r=m.getImageData(0,0,k.width,k.height),q=r.data,l,p,o;
for(l=0,p=q.length;
l<p;
l+=4){o=q[l]*0.3+q[l+1]*0.59+q[l+2]*0.11;
q[l]=o;
q[l+1]=o;
q[l+2]=o
}m.putImageData(r,0,0);
return k
},e=function(m){var s=f.defer(),l=document.createElement("canvas"),p=Math.max(j.imageConversion.resizeTo,b),o=m.width/m.height,r=p/Math.min(m.width,m.height),k=o>1?m.width*r:p,q=o>1?p:m.height*r,n=new MegaPixImage(m);
n.render(l,{width:k,height:q});
if(j.imageConversion.greyscale){h(l)
}s.resolve(l);
return s.promise
},g=function(l){var k=f.defer(),m=l.toDataURL(j.imageConversion.exportFormat,j.imageConversion.exportQuality);
l=null;
k.resolve(m);
return k.promise
},i=function(k){return c(k).then(e).then(g)
};
return{resizeImage:i,loadImage:c}
}angular.module("fileReader").factory("ImageResize",a);
a.$inject=["$q","$window"]
}());
(function(){angular.module("fileReader").directive("encodeImg",["FileReader",function a(c){return{restrict:"A",link:function b(e,f,d){f.on("change",function(g){var h=g.target||g.srcElement,i=h.files[0];
c.readAsDataUrl(i).then(e.ctrl.handleUploadedImage)
})
}}
}])
}());