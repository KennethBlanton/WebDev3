(function(c){var b=c.angular||{},a=b.module("simplePagination",[]);
a.factory("Pagination",function(){var d={};
d.getNew=function(e,f){if(e>f){e=f
}else{e=e?e:5
}var g={numPages:1,perPage:e,page:0};
g.prevPage=function(){if(g.page>0){g.page-=1
}};
g.nextPage=function(){if(g.page<g.numPages-1){g.page+=1
}};
g.toPageId=function(h){if(h>=0&&h<=g.numPages-1){g.page=h
}};
g.hasNextPage=function(){return g.page+1>=g.numPages
};
g.isFirstPage=function(){return g.page===0
};
g.getActualFirstItem=function(){return g.page*g.perPage
};
return g
};
return d
});
a.filter("startFrom",function(){return function(d,e){if(d===undefined){return d
}else{return d.slice(Number(e))
}}
});
a.filter("range",function(){return function(d,f){var e=0;
f=parseInt(f,10);
for(;
e<f;
e++){d.push(e)
}return d
}
})
}(window));
(function(b){var a=b.angular||{};
a.module("channelIq",["image-directives","error","simplePagination"])
}(window));
(function(b){var a=b.angular||{};
function c(){return{restrict:"A",link:function(e,d){d.on("click",function(f){var g=$(f.currentTarget);
g.parents(".dropdown").toggleClass("open");
g.next().toggle();
g.next().children("a:first").focus()
});
$(document).click(function(g){var h=this.children("button")[0],f=this.parents(".dropdown"),i=this.children(".dropdown-content"),j=i.is(":visible");
if(g.target!==this&&g.target!==h&&j){i.toggle();
this.toggleClass("open")
}}.bind(d.parent()))
}}
}a.module("channelIq").directive("ciqDropdown",c)
}(window));
(function(b){var a=b.angular||{};
function c(){return{restrict:"A",link:function(f,e){var d=e.parents(".channeliq_wrapper").offset().top-90;
e.on("click",function(g){$("body").animate({scrollTop:d},300)
})
}}
}a.module("channelIq").directive("ciqPagination",c)
}(window));
(function(b){function a(){var n=this,c=document.createElement("a");
function i(o){c.href=o;
return c.hostname
}function d(o){return o.domains.split(".").join("\\.").split("*\\.").join(".*").split(";").map($.trim).filter(Boolean)
}function h(o){return o.map(function(p){if(p.indexOf("www\\.")===0){p=p.replace("www\\.","")
}return new RegExp("^(www\\.)?"+p)
})
}function f(o){var q=d(o),p=h(q);
return{name:o.name,campaignId:o.campaignId,domains:p}
}function j(p,q){var o=i(p);
return q.test(o)
}function e(o,p){return p.domains.filter(function(q){return j(o,q)
}).length
}function l(o){var p=n.customTrafficSources.filter(function(q){return e(o,q)
});
if(p.length){return p[0].campaignId
}return n.defaultCampaignId
}function k(){var o=document.referrer;
n.campaignId=l(o)
}function m(o,p){n.customTrafficSources=p.map(f);
n.defaultCampaignId=o;
k()
}function g(){return n.campaignId
}return{init:m,getCampaignId:g}
}b.angular.module("channelIq").factory("channelIq.trafficSource.service",a)
}(window));
(function(d){var b=d.MarketingServices||{},c=d.angular||{};
function a(j,i,e){var h=i[0].getElementById("serviceEndpoint").value,g=h+"/api/getOnlineOffers?productIds=";
function f(k){var m=[],l="&campaignId="+e.getCampaignId();
k=[k];
g=g+k.toString()+"&pageNumber=1&itemsPerPage=1000"+l;
if(b.CookieManager.getItem("ko_access_token")){m["x-access-token"]=b.CookieManager.getItem("ko_access_token")
}return j({method:"GET",url:g,headers:m})
}return{getOnlineOffers:f}
}c.module("channelIq").factory("channelIq.api",a);
a.$inject=["$http","$document","channelIq.trafficSource.service"]
}(window));
(function(c){var a=c.angular||{};
function b(v,s,q,h,y,p,l){var n=this,f,t,x;
n.hasError=false;
function k(A){return A.IsInStock
}function r(A){return A.retailers.length>0
}function d(){if(n.imagesFinished()===false){q.showTimeout=true
}}function o(){var A=p("startFrom")(n.productObjectList,n.getActualFirstItem());
n.displayedProducts=p("limitTo")(A,n.pagination.perPage)
}function w(D,A,B){var C=new RegExp(A,"g");
return D.replace(C,B)
}function i(){n.productObjectList.forEach(function(B,A){B.productDescription=(x.productDescription)?w(x.productDescription,"{currentItem}",A+1):""
});
n.productListTitle=x.productListTitle;
n.productLabel=x.productLabel
}function j(A){n.trackingPixel=A.OfferGridTrackingPixel;
n.productObjectList.forEach(function(B){var C=A.onlineOffers.filter(function(D){return D.productId===B.productName.toLowerCase()
}).reduce(function(E,F){var D=F.offers;
return D.filter(k)
},[]);
B.retailers=C
});
if(n.hideOutOfStock){n.productObjectList=n.productObjectList.filter(r)
}n.productsInStock=n.productObjectList.length;
n.pagination=h.getNew(n.itemsPerPage,n.productsInStock);
n.pagination.numPages=Math.ceil(n.productsInStock/n.itemsPerPage);
n.isLoading=false;
n.hasError=false;
o();
i()
}function g(A){n.hasError=true;
n.isLoading=false;
n.errorMessage=A
}function e(A,B){var C=A||{},D=C.errorCode?C.errorCode:0,E=l.getErrorMsgByCode(n.errorMessagesObj,D);
g(E)
}function z(){return y(d,15000)
}function u(){if(t){y.cancel(t)
}t=z()
}function m(){q.imagesLoaded=0;
u()
}n.init=function(A){s.init(A.defaultCampaignId,A.customTrafficSources);
n.isLoading=true;
n.hideOutOfStock=A.hideOutOfStock===true;
n.componentPath=A.componentPath;
n.displayedProducts=[];
n.productObjectList=A.products;
n.itemsPerPage=Number(A.itemsPerPage);
n.dropdownMessages=A.dropdownMessages;
n.errorMessagesObj=A.errorMsgsObj;
q.imagesLoaded=0;
q.showTimeout=false;
t=z();
x=A.screenReaderJson;
f=n.productObjectList.map(function(B){return B.productName
});
n.loadOffers()
};
n.hasRetailers=function(A){return A.retailers&&(A.retailers.length||!n.hideOutOfStock)
};
n.disableNext=function(){return n.pagination.hasNextPage()
};
n.disablePrevious=function(){return n.pagination.isFirstPage()
};
n.showDropDown=function(A){return A.retailers&&A.retailers.length!==0
};
n.getActualFirstItem=function(){return n.pagination.getActualFirstItem()
};
n.paginationNext=function(){m();
n.pagination.nextPage();
o()
};
n.paginationPrevious=function(){m();
n.pagination.prevPage();
o()
};
n.loadOffers=function(){v.getOnlineOffers(f).success(j).error(e)
};
n.incrementCount=function(){q.imagesLoaded+=1;
q.$apply()
};
n.imagesFinished=function(){if(n.hasError){return true
}return(q.imagesLoaded===n.displayedProducts.length)||q.showTimeout
};
n.showNoProductsMessage=function(){return n.productsInStock===0&&n.hideOutOfStock
};
n.getProductDropdownDescription=function(A){return(A.retailers&&A.retailers.length)?x.retailerDropdownDescription:x.outOfStockDescription
};
n.isReadyToTrack=function(){return !n.isLoading&&n.imagesFinished()
};
n.showMessagesWrapper=function(){return n.showNoProductsMessage()||n.hasError
};
n.openRetailer=function(B,A){var C;
B.preventDefault();
C=c.open(A,"_blank");
C.focus()
}
}a.module("channelIq").controller("MainCtrl",b);
b.$inject=["channelIq.api","channelIq.trafficSource.service","$scope","Pagination","$timeout","$filter","error.errorManager"]
}(window));