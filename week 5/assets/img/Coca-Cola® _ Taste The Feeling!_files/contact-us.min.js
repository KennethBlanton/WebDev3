(function(){window.angular.module("angular-components.contact-us",["angularSpinner","ngSanitize","utility","angular-components.recaptcha","angular-components.bith-date"])
}());
(function(a){function b(i,l,j){var d=window.MarketingServices||{},m=j.getConfigValue("ccnagMktServicesEndpoint"),f=j.getConfigValue("ccnagMktServicesAWSKey");
function o(){var q={},p=d.CookieManager.getItem(d.Constants.KO_ACCESS_TOKEN);
q["x-api-key"]=f;
if(p){q.Authorization=p
}return{headers:q}
}function g(p){var q={};
if(p.data&&p.data.statusCode){q.errorCode=p.data.statusCode
}return i.reject(q)
}function c(p){return p.data
}function k(p){return p.data
}function n(p){var s={},q=new Date(),r=30;
if(p.data.message==="underage"){q.setTime(q.getTime()+(r*60*1000));
d.CookieManager.setItem("ko_underage_user","true",q)
}if(p.data&&p.data.message){s.message=p.data.message
}return i.reject(s)
}function h(p){return l.get(p,o()).then(c,g)
}function e(p){if(d.CookieManager.getItem("ko_underage_user")){return i.reject("underage")
}return l.post(m+"contact/v1/full",p,o()).then(k,n)
}return{getTopicsAndUserData:function(){if(m&&f){var p=m+"contact/v1/full";
return h(p)
}else{return i.reject({message:"Service configuration is missing"})
}},submitForm:function(p){return e(p)
}}
}b.$inject=["$q","$http","utility.mks-config"];
a.module("angular-components.contact-us").factory("contactUs.services.api",b)
}(window.angular));
(function(b,c){function a(n,k){var o=this,h=30,f=9,d=1000;
o.$onInit=function(){o.init();
o.loading=true;
o.submitting=false;
k.getTopicsAndUserData().then(function(p){if(p&&p.subjects){o.showForm=true;
o.topics=p.subjects;
o.validateAndPutField(o,"userFirstName",p.firstName);
o.validateAndPutField(o,"userLastName",p.lastName);
o.validateAndPutField(o,"userEmail",p.email);
o.validateAndPutField(o,"userDateOfBirth",p.dateOfBirth)
}else{o.hasTopicError=true
}},function(p){o.hasTopicError=true
}).then(o.loadingFinished)
};
o.init=function(){o.showForm=false;
o.hasTopicError=false;
o.loading=false;
o.showQualityFields=false;
o.recaptchaIsValid=false;
o.isBirthDateValid=false;
o.showSuccessMessage=false;
o.showSubmitError=false;
o.topics=null;
o.userFirstName=null;
o.userLastName=null;
o.userEmail=null;
o.userDateOfBirth=null;
o.selectedBrand=null;
o.selectedTopic=null;
o.message=null;
o.phone=null;
o.zipcode=null;
o.gRecaptchaResponse=null
};
o.onUpdateBirth=function(p,q){o.userDateOfBirth=null;
o.isBirthDateValid=q;
if(p.updatedYear&&p.updatedMonth&&p.updatedDay){o.userDateOfBirth=p.updatedYear+"-"+o.zpad(p.updatedMonth.id+1)+"-"+o.zpad(p.updatedDay)
}};
o.zpad=function i(p){return(p<10)?"0"+p:p
};
o.recaptchaUpdated=function(q,p){o.recaptchaIsValid=q;
o.gRecaptchaResponse=p;
n.$apply()
};
o.changeTopic=function e(){if(o.selectedTopic&&o.selectedTopic===o.settings.general.topicId){o.showQualityFields=true
}else{o.phone=null;
o.zipcode=null;
o.showQualityFields=false
}};
o.loadingFinished=function j(){o.loading=false;
o.submitting=false
};
o.validateAndPutField=function l(p,r,q){if(q){p[r]=q
}};
o.formSubmit=function g(){if(o.isBirthDateValid!==null&&!o.isBirthDateValid&&!o.userDateOfBirth){return
}if(!n.contactUs.$invalid&&o.recaptchaIsValid){o.showSuccessMessage=false;
o.showSubmitError=false;
o.submitting=true;
k.submitForm(o.createSubmissionObject()).then(function(){o.showForm=false;
o.showSuccessMessage=true;
o.scrollToTop()
},function(p){o.showSubmitError=true
}).then(o.loadingFinished)
}};
o.scrollToTop=function(){var p=o.settings.general.id;
window.scrollTo(0,$("#"+p).offset().top-$("#header").height())
};
n.$watch(function(){return o.message
}.bind(o),function(p){if(p&&p.length>d){o.message=p.substring(0,d)
}}.bind(o));
n.$watch(function(){return o.zipcode
}.bind(o),function(q,p){if(q&&q.length>f){o.zipcode=q.substring(0,f)
}}.bind(o));
n.$watch(function(){return o.phone
}.bind(o),function(p){if(p&&p.length>h){o.phone=p.substring(0,h)
}}.bind(o));
o.createSubmissionObject=function m(){var p={};
o.validateAndPutField(p,"brand",o.selectedBrand);
o.validateAndPutField(p,"dateOfBirth",o.userDateOfBirth);
o.validateAndPutField(p,"email",o.userEmail);
o.validateAndPutField(p,"firstName",o.userFirstName);
o.validateAndPutField(p,"gRecaptchaResponse",o.gRecaptchaResponse);
o.validateAndPutField(p,"lastName",o.userLastName);
o.validateAndPutField(p,"message",o.message);
o.validateAndPutField(p,"subject",o.selectedTopic);
if(o.showQualityFields){o.validateAndPutField(p,"phone",o.phone);
o.validateAndPutField(p,"zip",o.zipcode)
}return p
}
}a.$inject=["$scope","contactUs.services.api"];
b.module("angular-components.contact-us").component("contactUs",{templateUrl:"/etc/clientlibs/marketingservices/angular-components/contact-us/template/contact-us.html",controller:a,bindings:{settings:"<"}})
}(window.angular,window.alert));