(function(){window.angular.module("janrain-na.angular-components.survey",[])
}());
(function(a){function b(d,g){function k(){return{headers:{"x-access-token":KO.CookieManager.getItem("ko_access_token")}}
}function f(l){var m={};
if(l.data&&l.data.statusCode){m.errorCode=l.data.statusCode;
m.message=l.data.message
}return d.reject(m)
}function e(l){return l.data
}function c(m,n,l){return g.get(m+n+"/"+l).then(e,f)
}function h(l){return l.data
}function i(l){var m={};
if(l.data&&l.data.message){m.message=l.data.message
}return d.reject(m)
}function j(o,p,m,n){var l={surveyId:p,questionId:m,answer:n};
return g.post(o,l,k()).then(h,i)
}return{get:function(n,l){var m=OneKOID.JanrainSettings.janrainnaapidomain+"/api/getSurvey/";
return c(m,n,l)
},post:function(o,l,m){var n=OneKOID.JanrainSettings.janrainnaapidomain+"/api/postSurvey";
return j(n,o,l,m)
}}
}b.$inject=["$q","$http"];
a.module("janrain-na.angular-components.survey").factory("survey.services.api",b)
}(window.angular));
(function(a){function b(e,d,h){var c=this;
c.$onInit=function(){OneKOID.Events.subscribeSync("auth-api-registration-completed",c.submit,"survey-submit");
OneKOID.Events.subscribe("registration-screen-show-errors",c.showErrors);
c.init();
c.surveyList=[];
c.surveyConfig={};
c.shouldShowErrors=false
};
c.init=function(){var i=$($(".survey-settings")[0]);
if(i&&i.data("survey-settings")){c.surveyConfig=a.fromJson(i.data("survey-settings"))
}if(c.surveyConfig){c.surveyConfig.forEach(function(j){if(j.surveyId&&j.questionId){h.get(j.surveyId,j.questionId).then(function(k){if(c.isValidSurvey(k)){var l={surveyId:j.surveyId,questionId:j.questionId,question:k.question,answers:[],isRequired:j.isRequired,surveyIndex:j.surveyIndex};
k.answer.forEach(function(m){l.answers.push({optionString:m.optionString,answerOrder:m.answerOrder})
});
c.surveyList.push(l)
}})
}})
}};
c.isValidSurvey=function(i){if(i&&i.question&&i.answer&&i.answer.length>0){return true
}return false
};
function g(j,i){if(!j.selectedAnswer){return
}i.push(h.post(j.surveyId,j.questionId,j.selectedAnswer))
}c.submit=function(j){var i=[];
c.surveyList.forEach(function(k){g(k,i)
});
d.all(i).then(function(){j()
},function(){j()
})
};
c.showErrors=function(){c.shouldShowErrors=true;
e.$apply()
};
function f(i){return i.isRequired&&!i.selectedAnswer
}c.validateSurvey=function(){return !c.surveyList.some(f)
}
}b.$inject=["$scope","$q","survey.services.api"];
a.module("janrain-na.angular-components.survey").component("survey",{templateUrl:"/etc/clientlibs/janrain-na/angular-components/survey/template/survey.html",controller:b})
}(window.angular));
(function(a){var b=window.OneKOID||{};
b.SurveyInject={};
b.SurveyInject.onTraditionalRegistration=function(){b.SurveyInject.onScreenLoad(".janrain-survey-traditional-registration")
};
b.SurveyInject.onSocialRegistration=function(){b.SurveyInject.onScreenLoad(".janrain-survey-social-registration")
};
b.SurveyInject.onScreenLoad=function(c){$(c).html('<survey data-ng-module="janrain-na.angular-components.survey"></survey>');
window.initNgModules(a.element($(c)[0]))
};
b.Events.subscribe("traditional-registration-screen-show",b.SurveyInject.onTraditionalRegistration);
b.Events.subscribe("social-registration-screen-show",b.SurveyInject.onSocialRegistration)
}(window.angular));